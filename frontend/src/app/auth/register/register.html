<!-- Navbar -->
<mat-toolbar class="navbar">
  <a routerLink="/" class="navbar-brand">
    <mat-icon class="brand-icon">hub</mat-icon>
    <span class="brand-name">CampusNet</span>
  </a>
  <span class="spacer"></span>
  <a mat-button routerLink="/auth/login" class="nav-link">Sign in</a>
</mat-toolbar>

<!-- Page -->
<div class="auth-page">
  <div class="glow glow-1"></div>
  <div class="glow glow-2"></div>

  <div class="auth-container">
    <!-- Card -->
    <div class="auth-card">
      <div class="card-header">
        <div class="card-icon-wrap">
          <mat-icon class="card-icon">person_add</mat-icon>
        </div>
        <h1 class="card-title">Create your account</h1>
        <p class="card-subtitle">Join your campus community today — it's free</p>
      </div>

      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="auth-form" novalidate>
        <!-- Full Name -->
        <mat-form-field appearance="outline" class="field">
          <mat-label>Full name</mat-label>
          <input matInput formControlName="fullName" autocomplete="name" />
          <mat-icon matPrefix class="field-prefix-icon">badge</mat-icon>
          @if (form.get('fullName')?.hasError('required') && form.get('fullName')?.touched) {
            <mat-error>Full name is required</mat-error>
          } @else if (
            form.get('fullName')?.hasError('minlength') && form.get('fullName')?.touched
          ) {
            <mat-error>Name must be at least 2 characters</mat-error>
          }
        </mat-form-field>

        <!-- Email -->
        <mat-form-field appearance="outline" class="field">
          <mat-label>University email</mat-label>
          <input matInput type="email" formControlName="email" autocomplete="email" />
          <mat-icon matPrefix class="field-prefix-icon">alternate_email</mat-icon>
          @if (form.get('email')?.hasError('required') && form.get('email')?.touched) {
            <mat-error>Email is required</mat-error>
          } @else if (form.get('email')?.hasError('email') && form.get('email')?.touched) {
            <mat-error>Enter a valid email address</mat-error>
          }
        </mat-form-field>

        <!-- Department -->
        <mat-form-field appearance="outline" class="field">
          <mat-label>Department</mat-label>
          <mat-select formControlName="department">
            @for (dept of departments; track dept) {
              <mat-option [value]="dept">{{ dept }}</mat-option>
            }
          </mat-select>
          <mat-icon matPrefix class="field-prefix-icon">school</mat-icon>
          @if (form.get('department')?.hasError('required') && form.get('department')?.touched) {
            <mat-error>Please select your department</mat-error>
          }
        </mat-form-field>

        <!-- Password -->
        <mat-form-field appearance="outline" class="field">
          <mat-label>Password</mat-label>
          <input
            matInput
            [type]="hidePassword ? 'password' : 'text'"
            formControlName="password"
            autocomplete="new-password"
          />
          <mat-icon matPrefix class="field-prefix-icon">key</mat-icon>
          <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="hidePassword = !hidePassword"
            class="toggle-visibility"
          >
            <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          @if (form.get('password')?.hasError('required') && form.get('password')?.touched) {
            <mat-error>Password is required</mat-error>
          } @else if (
            form.get('password')?.hasError('minlength') && form.get('password')?.touched
          ) {
            <mat-error>Password must be at least 8 characters</mat-error>
          }
        </mat-form-field>

        <!-- Confirm Password -->
        <mat-form-field appearance="outline" class="field">
          <mat-label>Confirm password</mat-label>
          <input
            matInput
            [type]="hideConfirm ? 'password' : 'text'"
            formControlName="confirmPassword"
            autocomplete="new-password"
          />
          <mat-icon matPrefix class="field-prefix-icon">lock_reset</mat-icon>
          <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="hideConfirm = !hideConfirm"
            class="toggle-visibility"
          >
            <mat-icon>{{ hideConfirm ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          @if (
            form.get('confirmPassword')?.touched &&
            (form.hasError('mismatch') || form.get('confirmPassword')?.hasError('required'))
          ) {
            <mat-error>{{
              form.get('confirmPassword')?.hasError('required')
                ? 'Please confirm your password'
                : 'Passwords do not match'
            }}</mat-error>
          }
        </mat-form-field>

        <!-- Terms note -->
        <p class="terms-note">
          By creating an account you agree to our
          <a href="#" class="terms-link">Terms of Service</a> and
          <a href="#" class="terms-link">Privacy Policy</a>.
        </p>

        <!-- Submit -->
        <button
          mat-flat-button
          type="submit"
          class="submit-btn"
          [disabled]="loading"
        >
          @if (loading) {
            <mat-spinner diameter="20" class="btn-spinner"></mat-spinner>
          }
          <span class="btn-label">{{ loading ? 'Creating account…' : 'Create Account' }}</span>
          @if (!loading) {
            <mat-icon>arrow_forward</mat-icon>
          }
        </button>
      </form>

      <!-- Divider -->
      <div class="divider">
        <span class="divider-line"></span>
        <span class="divider-text">Already have an account?</span>
        <span class="divider-line"></span>
      </div>

      <a mat-stroked-button routerLink="/auth/login" class="alt-btn">Sign in instead</a>
    </div>
  </div>
</div>
